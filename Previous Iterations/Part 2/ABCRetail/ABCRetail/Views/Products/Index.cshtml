@model IEnumerable<ABCRetail.Models.Product>

@{
    var isLoggedIn = ViewBag.LOGGEDIN ?? false; // Assume LOGGEDIN is passed through ViewBag
}

<section id="header" class="jumbotron text-center">
    <h1 class="display-3">Product List</h1>
    <p class="lead">Browse our selection of high-quality products. Find the perfect items to suit your needs and taste.</p>
</section>

<section id="gallery">
    <div class="container">
        <div class="row">
            @if (Model == null || !Model.Any())
            {
                <p class="text-center">No products found.</p>
            }
            else
            {
                @foreach (var product in Model)
                {
                    <div class="col-md-4 col-lg-3 mb-4">
                        <div class="card h-100">
                            <img src="@product.ImageUrl" class="card-img-top" alt="Product Image" style="height: 200px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">@product.ProductName</h5>
                                <p class="card-text">@product.Description</p>
                                <p class="card-text"><strong>Price:</strong> R @product.price</p>
                                <p class="card-text"><strong>Origin:</strong> @product.Location</p>
                                <form asp-action="Cart" method="get" class="mt-3">
                                    <input type="hidden" name="productId" value="@product.RowKey" />
                                    <button type="submit" class="btn btn-primary btn-block">Order</button>
                                </form>
                            </div>
                        </div>
                    </div>
                }

            }
        </div>
    </div>
</section>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var isLoggedIn = @isLoggedIn.ToString().ToLower(); // Convert to lowercase for JS boolean

            document.querySelectorAll('.btn-primary').forEach(function (button) {
                button.addEventListener('click', function () {
                    if (!isLoggedIn) {
                        toastr.warning("You must sign in first!");
                        setTimeout(function () {
                            window.location.href = '@Url.Action("Login", "Users")'; // Redirect to login
                        }, 2000); // Wait for 2 seconds before redirect
                    }
                });
            });
        });
    </script>
}
